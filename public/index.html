<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<h2>Where's Waldo ?</h2>
<form id="score-form" style="display:none;">
    <label for="player-name">Name :</label>
    <input type="text" id="player-name" required>
    <button type="submit">Save score</button>
  </form>
  
  <div id="leaderboard" style="display:none;">
    <h2>Top10</h2>
    <ol id="leaderboard-list"></ol>
  </div>
<img  id="myimage" src="waldo1.jpeg" height="1000px" width="1750px"/>


    
</body>
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore.js";

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyDjPAyUmMGosOlTzEz0whdl8lvHlCk4Stw",
  authDomain: "waldo-f0134.firebaseapp.com",
  projectId: "waldo-f0134",
  storageBucket: "waldo-f0134.appspot.com",
  messagingSenderId: "630658148560",
  appId: "1:630658148560:web:be90b4692bbceb3db1d6d5"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let time = Date.now(); // to have the time in seconds since the oppening of the page until the winning
let final2;

myimage.onclick = function(e) { // to retrieve the image pixels on click (x, y coordinnates)

    var ratioX = e.target.naturalWidth / e.target.offsetWidth;
        var ratioY = e.target.naturalHeight / e.target.offsetHeight;
      
        var domX = e.x + window.pageXOffset - e.target.offsetLeft;
        var domY = e.y + window.pageYOffset - e.target.offsetTop;
      
        var x = Math.floor(domX * ratioX);
        var y = Math.floor(domY * ratioY); 


    if (x > 1194 && x < 1236 && y > 1199 && y < 1311) { // this is the location of waldo, so if the click is here, you won
        let time2 = Date.now();
        let final = time2 - time; // to have the time in seconds since the oppening of the page until the winning
        final2 = (final/1000).toFixed(0); 
        alert(`gg, done in ${final2} seconds`);
        document.getElementById("score-form").style.display = "block";

    }



};

async function saveScore(name, score) { // function to save score to db
  try {
    await addDoc(collection(db, "scores"), {
      name: name,
      score: parseInt(score)
    });
  } catch (e) {
    console.error("Error adding document: ", e);
  }
}

document.getElementById("score-form").addEventListener("submit", async (e) => { // displays the input form to save score with your username
  e.preventDefault();
  const playerName = document.getElementById("player-name").value;
  await saveScore(playerName, final2);
  document.getElementById("score-form").style.display = "none";
  document.getElementById("player-name").value = "";
  displayLeaderboard();  
});

async function displayLeaderboard() { // displays the ranking
  const leaderboardList = document.getElementById("leaderboard-list");
  leaderboardList.innerHTML = "";

  const q = query(collection(db, "scores"), orderBy("score", "asc"), limit(10));
  const querySnapshot = await getDocs(q);

  querySnapshot.forEach((doc) => {
    const scoreData = doc.data();
    const listItem = document.createElement("li");
    listItem.textContent = `${scoreData.name} : ${scoreData.score} seconds`;
    leaderboardList.appendChild(listItem);
  });

  document.getElementById("leaderboard").style.display = "block";
}




      
</script>

</html>